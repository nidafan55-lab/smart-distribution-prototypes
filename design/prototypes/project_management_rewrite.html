<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>项目管理 - 分账系统</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    .modal {
      transition: opacity 0.25s ease;
      /* 让弹窗层级高于抽屉（drawer 的 z-index 为 1000） */
      z-index: 1100;
    }
    /* 提升弹窗覆盖层与容器层级，确保处于最上层 */
    .modal .modal-overlay { z-index: 1100; }
    .modal .modal-container { z-index: 1101; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    .table-fixed {
      table-layout: fixed;
    }
    
    /* 右侧抽屉样式 */
    .drawer {
      position: fixed;
      top: 0;
      right: -100%;
      width: 40%;
      height: 100%;
      background-color: white;
      box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
      transition: right 0.3s ease;
      z-index: 1000;
      overflow-y: auto;
    }
    .drawer.open {
      right: 0;
    }
    .drawer-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 999;
      display: none;
    }
    .drawer-overlay.open {
      display: block;
    }
    
    /* 思维导图样式 */
    .mindmap-container {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
      overflow: auto;
    }
    .mindmap-central-node {
      position: relative;
      z-index: 1;
      background: #111827;
      color: white;
      padding: .75rem 1.5rem;
      border-radius: 9999px;
      font-weight: 600;
      flex-shrink: 0;
    }
    .mindmap-branches {
      display: flex;
      flex-direction: row;
      align-items: flex-start;
      gap: 1.5rem;
      margin-top: 2rem;
    }
    .mindmap-branch {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.5rem;
    }
    .mindmap-node {
      position: relative;
      z-index: 1;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      padding: .5rem 1rem;
      border-radius: .5rem;
      white-space: nowrap;
      flex-shrink: 0;
    }
    .mindmap-children {
      display: flex;
      flex-direction: row;
      align-items: flex-start;
      gap: 1.5rem;
    }
    .mindmap-links {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }
    
    /* 添加抽屉动画效果 */
    .drawer {
      transition: right 0.3s ease-in-out;
    }
    .drawer-overlay {
      transition: opacity 0.3s ease-in-out;
      opacity: 0;
    }
    .drawer-overlay.open {
      opacity: 1;
    }
  </style>
</head>
<body class="bg-gray-50">
  <div class="container mx-auto px-4 py-6">
    <!-- 页面头部 -->
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold text-gray-800">项目管理</h1>
    </div>

    <!-- 统计卡片 -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
      <div class="bg-white rounded-lg shadow p-4">
        <div class="flex items-center">
          <div class="rounded-full bg-blue-100 p-3 mr-4">
            <i class="fas fa-project-diagram text-blue-600 text-xl"></i>
          </div>
          <div>
            <p class="text-sm text-gray-500">项目总数</p>
            <p class="text-xl font-bold">24</p>
          </div>
        </div>
      </div>
      <div class="bg-white rounded-lg shadow p-4">
        <div class="flex items-center">
          <div class="rounded-full bg-yellow-100 p-3 mr-4">
            <i class="fas fa-clock text-yellow-600 text-xl"></i>
          </div>
          <div>
            <p class="text-sm text-gray-500">待审核</p>
            <p class="text-xl font-bold">5</p>
          </div>
        </div>
      </div>
      <div class="bg-white rounded-lg shadow p-4">
        <div class="flex items-center">
          <div class="rounded-full bg-green-100 p-3 mr-4">
            <i class="fas fa-check-circle text-green-600 text-xl"></i>
          </div>
          <div>
            <p class="text-sm text-gray-500">已完成</p>
            <p class="text-xl font-bold">16</p>
          </div>
        </div>
      </div>
      <div class="bg-white rounded-lg shadow p-4">
        <div class="flex items-center">
          <div class="rounded-full bg-red-100 p-3 mr-4">
            <i class="fas fa-exclamation-circle text-red-600 text-xl"></i>
          </div>
          <div>
            <p class="text-sm text-gray-500">异常</p>
            <p class="text-xl font-bold">3</p>
          </div>
        </div>
      </div>
    </div>

    <!-- 筛选器 -->
    <div class="bg-white rounded-lg shadow p-4 mb-6">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">项目状态</label>
          <select class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="">全部</option>
            <option value="pending">待审核</option>
            <option value="approved">已审核</option>
            <option value="completed">已完成</option>
            <option value="error">异常</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">创建时间</label>
          <input type="date" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">项目名称</label>
          <input type="text" placeholder="请输入项目名称" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div class="flex items-end">
          <button class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md shadow-sm mr-2">
            <i class="fas fa-search mr-1"></i>查询
          </button>
          <button class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-4 rounded-md shadow-sm">
            <i class="fas fa-redo-alt mr-1"></i>重置
          </button>
        </div>
      </div>
    </div>

    <!-- 项目列表表格 -->
    <div class="bg-white rounded-lg shadow overflow-hidden mb-6">
      <div class="p-4 border-b border-gray-200 flex justify-between items-center">
        <h2 class="text-lg font-medium text-gray-800">项目列表</h2>
        <div>
          <button class="bg-green-600 hover:bg-green-700 text-white font-medium py-1.5 px-3 rounded-md shadow-sm text-sm mr-2">
            <i class="fas fa-file-excel mr-1"></i>导出
          </button>
        </div>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200 table-fixed">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-16">
                序号
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                项目名称
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                创建人
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                创建时间
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                状态
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                操作
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200" id="projectTableBody">
            <!-- 示例数据将通过JavaScript动态生成 -->
          </tbody>
        </table>
      </div>
      <div class="px-6 py-4 flex items-center justify-between border-t border-gray-200">
        <div class="text-sm text-gray-500">
          显示 <span class="font-medium">1</span> 到 <span class="font-medium">10</span> 条，共 <span class="font-medium">24</span> 条
        </div>
        <div class="flex-1 flex justify-center">
          <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
            <a href="#" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
              <span class="sr-only">上一页</span>
              <i class="fas fa-chevron-left"></i>
            </a>
            <a href="#" class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-blue-50 text-sm font-medium text-blue-600 hover:bg-blue-100">
              1
            </a>
            <a href="#" class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
              2
            </a>
            <a href="#" class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
              3
            </a>
            <a href="#" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
              <span class="sr-only">下一页</span>
              <i class="fas fa-chevron-right"></i>
            </a>
          </nav>
        </div>
        <div class="text-sm text-gray-500">
          每页 
          <select class="border border-gray-300 rounded-md px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
            <option>10</option>
            <option>20</option>
            <option>50</option>
          </select>
          条
        </div>
      </div>
    </div>

    <!-- 模态窗口 - 上传分账协议 -->
    <div id="uploadAgreementModal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50 hidden">
      <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div>
      <div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded shadow-lg z-50 overflow-y-auto">
        <div class="modal-content py-4 text-left px-6">
          <div class="flex justify-between items-center pb-3">
            <p class="text-lg font-bold">上传分账协议</p>
            <div class="modal-close cursor-pointer z-50">
              <i class="fas fa-times"></i>
            </div>
          </div>
          <div class="my-4">
            <iframe id="uploadModalFrame" src="" class="w-full h-[60vh] bg-white rounded"></iframe>
          </div>
          <div class="flex justify-end pt-2">
            <button class="modal-close px-4 bg-gray-200 p-2 rounded-md text-gray-600 hover:bg-gray-300 mr-2">取消</button>
            <button class="px-4 bg-blue-600 p-2 rounded-md text-white hover:bg-blue-700">确认上传</button>
          </div>
        </div>
      </div>
    </div>

    <!-- 右侧抽屉 - 查看分账协议 -->
    <div id="viewAgreementDrawer" class="drawer">
      <div class="p-6">
        <div class="flex justify-between items-center pb-3 border-b">
          <p class="text-lg font-bold">分账协议详情</p>
          <div class="drawer-close cursor-pointer z-50">
            <i class="fas fa-times"></i>
          </div>
        </div>
        <div class="my-4">
          <iframe id="viewDrawerFrame" src="" class="w-full h-[60vh] bg-white rounded"></iframe>
        </div>
        <div class="my-4 hidden">
          <div class="bg-gray-100 p-4 rounded-md">
            <h3 class="font-medium mb-2">项目基本信息</h3>
            <div class="grid grid-cols-2 gap-4">
              <div>
                <p class="text-sm text-gray-500">项目名称</p>
                <p class="text-sm">2023年Q3营销活动分账</p>
              </div>
              <div>
                <p class="text-sm text-gray-500">创建时间</p>
                <p class="text-sm">2023-07-15 14:30:25</p>
              </div>
              <div>
                <p class="text-sm text-gray-500">创建人</p>
                <p class="text-sm">张三</p>
              </div>
              <div>
                <p class="text-sm text-gray-500">状态</p>
                <p class="text-sm"><span class="text-green-600">已审核</span></p>
              </div>
            </div>
          </div>

 <div class="mt-4">
            <h3 class="font-medium mb-2">账目表</h3>
            <div class="border border-gray-300 rounded-md overflow-hidden">
              <table class="min-w-full">
                <thead class="bg-gray-100">
                  <tr>
                    <th class="py-2 px-4 border-b text-left">账目</th>
                    <th class="py-2 px-4 border-b text-right">账目总额</th>
                    <th class="py-2 px-4 border-b text-right">保证金</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="py-2 px-4 border-b">
                      商品收入 <span class="text-blue-600">[当前]</span>
                    </td>
                    <td class="py-2 px-4 border-b text-right">0</td>
                    <td class="py-2 px-4 border-b text-right">0</td>
                  </tr>
                  <tr>
                    <td class="py-2 px-4 border-b">退款</td>
                    <td class="py-2 px-4 border-b text-right">0</td>
                    <td class="py-2 px-4 border-b text-right">0</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="mt-4">
            <h3 class="font-medium mb-2">分账树状预览图</h3>
            <div class="border border-gray-300 rounded-md p-4 bg-white">
              <div class="mindmap-container">
                <div class="mindmap-central-node">未命名方案</div>
                <div class="mindmap-branches">
                  <div class="mindmap-branch">
                    <div class="mindmap-node">渠道-抖音 · P1:0%</div>
                    <div class="mindmap-children">
                      <div class="mindmap-branch">
                        <div class="mindmap-node">平台-服务费 · P1:0%</div>
                      </div>
                    </div>
                  </div>
                  <div class="mindmap-branch">
                    <div class="mindmap-node">门店-杭州西湖 · P1:0%</div>
                  </div>
                </div>
                <div class="mindmap-links">
                  <svg width="100%" height="100%">
                    <!-- 中心节点到渠道-抖音的连接线 -->
                    <path d="M250,50 C250,80 150,100 150,130" stroke="#4299e1" stroke-width="2" fill="none"></path>
                    <!-- 中心节点到门店-杭州西湖的连接线 -->
                    <path d="M250,50 C250,80 350,100 350,130" stroke="#4299e1" stroke-width="2" fill="none"></path>
                    <!-- 渠道-抖音到平台-服务费的连接线 -->
                    <path d="M150,150 C150,170 150,180 150,200" stroke="#4299e1" stroke-width="2" fill="none"></path>
                  </svg>
                </div>
              </div>
            </div>
          </div>
          
         <div class="mt-4">
            <h3 class="font-medium mb-2">协议文件</h3>
            <div class="border border-gray-300 rounded-md p-3 flex items-center justify-between">
              <div class="flex items-center">
                <i class="far fa-file-pdf text-red-500 text-xl mr-2"></i>
                <span>营销活动分账协议.pdf</span>
              </div>
              <button class="text-blue-600 hover:text-blue-800">
                <i class="fas fa-download mr-1"></i>下载
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 右侧抽屉 - 协议审核 -->
    <div id="reviewAgreementDrawer" class="drawer">
      <div class="drawer-content px-8">
        <div class="flex justify-between items-center border-b pb-4">
          <h2 class="text-xl font-bold">协议审核</h2>
          <button onclick="hideDrawer('reviewAgreementDrawer')" class="text-gray-500 hover:text-gray-700">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="mt-4">
          <iframe id="reviewDrawerFrame" src="" class="w-full h-[60vh] bg-white rounded"></iframe>
        </div>
        
        <!-- 协议汇总信息 -->
        <div class="mt-6 bg-gray-50 p-6 rounded-lg">
          <div class="flex justify-between items-center">
            <div class="flex space-x-12">
              <div>
                <p class="text-gray-500">应收协议</p>
                <p class="font-medium text-lg">3份</p>
              </div>
              <div>
                <p class="text-gray-500">未收协议</p>
                <p class="font-medium text-lg text-red-500">1份</p>
              </div>
            </div>
            <button class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
              <i class="far fa-bell mr-1"></i>发送提醒
            </button>
          </div>
        </div>
        
        <!-- 协议列表 -->
        <div class="mt-8">
          <h3 class="text-lg font-semibold mb-4">协议列表</h3>
          
          <!-- 渠道-抖音 -->
          <div class="border rounded-lg p-6 mb-4">
            <div class="flex justify-between items-center mb-3">
              <div>
                <p class="font-medium">渠道-抖音</p>
                <p class="text-sm text-gray-500 mt-1">上传时间: 2023-10-18 15:30:25</p>
              </div>
              <div class="flex items-center">
                <span class="text-green-500 mr-2"><i class="fas fa-check-circle"></i> 待审核</span>
              </div>
            </div>
            <div class="flex justify-between mt-3">
              <button class="text-blue-600 hover:text-blue-800">
                <i class="fas fa-download mr-1"></i>下载PDF
              </button>
              <button id="approveBtn1" onclick="approveAgreement(this, 'status1')" class="bg-green-500 hover:bg-green-600 text-white px-4 py-1 rounded text-sm">
                <i class="fas fa-check mr-1"></i>审核通过
              </button>
            </div>
          </div>
          
          <!-- 门店-杭州西湖 -->
          <div class="border rounded-lg p-6 mb-4">
            <div class="flex justify-between items-center mb-3">
              <div>
                <p class="font-medium">门店-杭州西湖</p>
                <p class="text-sm text-gray-500 mt-1">上传时间: 2023-10-17 09:45:12</p>
              </div>
              <div class="flex items-center">
                <span id="status2" class="text-green-500 mr-2"><i class="fas fa-check-circle"></i> 待审核</span>
              </div>
            </div>
            <div class="flex justify-between mt-3">
              <button class="text-blue-600 hover:text-blue-800">
                <i class="fas fa-download mr-1"></i>下载PDF
              </button>
              <button id="approveBtn2" onclick="approveAgreement(this, 'status2')" class="bg-green-500 hover:bg-green-600 text-white px-4 py-1 rounded text-sm">
                <i class="fas fa-check mr-1"></i>审核通过
              </button>
            </div>
          </div>
          
          <!-- 平台-服务费 -->
          <div class="border rounded-lg p-6">
            <div class="flex justify-between items-center mb-3">
              <div>
                <p class="font-medium">平台-服务费</p>
                <p class="text-sm text-gray-500 mt-1">未上传</p>
              </div>
              <div class="flex items-center">
                <span class="text-red-500 mr-2"><i class="fas fa-exclamation-circle"></i> 未上传</span>
              </div>
            </div>
            <div class="flex justify-between mt-3">
              <button class="text-gray-400 cursor-not-allowed">
                <i class="fas fa-download mr-1"></i>下载PDF
              </button>
              <button class="bg-gray-300 text-gray-500 px-4 py-1 rounded text-sm cursor-not-allowed">
                <i class="fas fa-check mr-1"></i>审核通过
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 右侧抽屉 - 保证金 -->
    <div id="depositDrawer" class="drawer">
      <div class="p-6">
        <div class="flex justify-between items-center pb-3 border-b">
          <p class="text-lg font-bold">保证金管理</p>
          <div class="drawer-close cursor-pointer z-50">
            <i class="fas fa-times"></i>
          </div>
        </div>
        <div class="mt-4">
          <iframe id="depositDrawerFrame" src="" class="w-full h-[60vh] bg-white rounded"></iframe>
        </div>
        <div class="mt-4 grid grid-cols-1 gap-4 hidden">
          <div class="bg-gray-50 rounded-md p-4 flex items-center justify-between">
            <span class="text-gray-600">保证金金额</span>
            <span id="depositTotal" class="text-lg font-semibold">—</span>
          </div>
          <div class="bg-gray-50 rounded-md p-4 flex items-center justify-between">
            <span class="text-gray-600">已缴保证金额</span>
            <span id="depositPaid" class="text-lg font-semibold text-green-600">—</span>
          </div>
          <div class="bg-gray-50 rounded-md p-4 flex items-center justify-between">
            <span class="text-gray-600">待缴保证金额</span>
            <span id="depositPending" class="text-lg font-semibold text-red-600">—</span>
          </div>
        </div>
        <div class="mt-6 flex justify-end hidden">
          <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded" onclick="submitDepositAudit()">
            <i class="far fa-paper-plane mr-1"></i>补缴审核
          </button>
        </div>
      </div>
    </div>

    <!-- 右侧抽屉 - 账号审核 -->
    <div id="accountAuditDrawer" class="drawer">
      <div class="p-6">
        <div class="flex justify-between items-center pb-3 border-b">
          <p class="text-lg font-bold">账号保证金审核</p>
          <div class="drawer-close cursor-pointer z-50">
            <i class="fas fa-times"></i>
          </div>
        </div>
        <div class="mt-4">
          <iframe id="accountAuditDrawerFrame" src="" class="w-full h-[60vh] bg-white rounded"></iframe>
        </div>
        <div class="mt-4 hidden">
          <table class="min-w-full border rounded-md overflow-hidden">
            <thead class="bg-gray-100">
              <tr>
                <th class="py-2 px-4 border-b text-left text-sm">账户名称</th>
                <th class="py-2 px-4 border-b text-right text-sm">应缴保证金</th>
                <th class="py-2 px-4 border-b text-right text-sm">已缴保证金</th>
                <th class="py-2 px-4 border-b text-right text-sm">待缴</th>
                <th class="py-2 px-4 border-b text-left text-sm">状态</th>
                <th class="py-2 px-4 border-b text-right text-sm">操作</th>
              </tr>
            </thead>
            <tbody id="accountAuditTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- 编辑保证金额弹窗 -->
    <div id="editDepositModal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50 hidden">
      <div class="modal-overlay absolute w-full h-full bg-black opacity-50"></div>
      <div class="modal-container bg-white w-11/12 md:w-1/2 mx-auto rounded shadow-lg z-50 overflow-y-auto">
        <div class="modal-content p-6">
          <div class="flex justify-between items-center pb-3 border-b">
            <p class="text-lg font-bold">编辑保证金额</p>
            <button class="modal-close"><i class="fas fa-times"></i></button>
          </div>
          <div class="mt-4 space-y-3">
            <div>
              <label class="text-sm text-gray-600">账户名称</label>
              <p id="editAccountName" class="text-sm text-gray-900">—</p>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-600">应缴保证金</span>
              <span id="editRequiredAmount" class="text-sm text-gray-900">—</span>
            </div>
            <div>
              <label for="editDepositAmount" class="block text-sm text-gray-600 mb-1">已缴保证金</label>
              <input id="editDepositAmount" type="number" step="0.01" class="w-full border rounded px-3 py-2" placeholder="请输入金额">
            </div>
          </div>
          <div class="mt-6 flex justify-end gap-3">
            <button class="modal-close bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded">取消</button>
            <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded" onclick="saveEditedDeposit()">保存</button>
          </div>
        </div>
      </div>
    </div>
    
    <script>
      // 审核通过按钮点击事件
      function approveAgreement(button, statusId) {
        // 更改状态文本为"已通过"
        const statusElement = document.getElementById(statusId);
        if (statusElement) {
          statusElement.innerHTML = '<i class="fas fa-check-circle"></i> 已通过';
          statusElement.className = 'text-blue-500 mr-2';
        }
        
        // 禁用按钮
        button.disabled = true;
        button.className = 'bg-gray-300 text-gray-500 px-4 py-1 rounded text-sm cursor-not-allowed';
        button.innerHTML = '<i class="fas fa-check mr-1"></i>已审核';
      }
    </script>
           
    <div id="drawerOverlay" class="drawer-overlay"></div>

    <!-- 模态窗口 - 审核项目 -->
    <div id="reviewProjectModal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50 hidden">
      <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div>
      <div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded shadow-lg z-50 overflow-y-auto">
        <div class="modal-content py-4 text-left px-6">
          <div class="flex justify-between items-center pb-3">
            <p class="text-lg font-bold">审核项目</p>
            <div class="modal-close cursor-pointer z-50">
              <i class="fas fa-times"></i>
            </div>
          </div>
          <div class="my-4">
            <p class="mb-4">确认审核通过"2023年Q3营销活动分账"项目吗？</p>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">审核意见</label>
              <textarea class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3" placeholder="请输入审核意见（选填）"></textarea>
            </div>
          </div>
          <div class="flex justify-end pt-2">
            <button class="modal-close px-4 bg-gray-200 p-2 rounded-md text-gray-600 hover:bg-gray-300 mr-2">取消</button>
            <button class="px-4 bg-green-600 p-2 rounded-md text-white hover:bg-green-700">通过</button>
            <button class="px-4 bg-red-600 p-2 rounded-md text-white hover:bg-red-700 ml-2">驳回</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // 示例项目数据
    const projectData = [
      { id: 1, name: "分账项目", creator: "用户", createTime: "2023-10-15 10:30:25", status: "pending" },
      { id: 2, name: "2023年Q3营销活动分账", creator: "张三", createTime: "2023-07-15 14:30:25", status: "approved" },
      { id: 3, name: "电商平台佣金分账", creator: "李四", createTime: "2023-07-20 09:15:42", status: "pending" },
      { id: 4, name: "新产品上市推广费用分账", creator: "王五", createTime: "2023-07-22 16:45:10", status: "completed" },
      { id: 5, name: "年度合作伙伴分润", creator: "赵六", createTime: "2023-07-25 11:20:35", status: "error" },
      { id: 6, name: "跨部门协作项目分账", creator: "张三", createTime: "2023-07-28 15:10:18", status: "pending" },
      { id: 7, name: "线下活动费用分账", creator: "李四", createTime: "2023-08-01 10:05:30", status: "completed" },
      { id: 8, name: "渠道销售佣金分账", creator: "王五", createTime: "2023-08-03 14:25:45", status: "completed" },
      { id: 9, name: "技术服务费分账", creator: "赵六", createTime: "2023-08-05 09:30:22", status: "pending" },
      { id: 10, name: "内容创作者分润", creator: "张三", createTime: "2023-08-08 16:40:15", status: "approved" },
      { id: 11, name: "季度销售提成分账", creator: "李四", createTime: "2023-08-10 11:55:38", status: "completed" }
    ];

    // 状态对应的样式和文本
    const statusConfig = {
      pending: { class: "bg-yellow-100 text-yellow-800", text: "待审核" },
      approved: { class: "bg-blue-100 text-blue-800", text: "已审核" },
      completed: { class: "bg-green-100 text-green-800", text: "已完成" },
      error: { class: "bg-red-100 text-red-800", text: "异常" },
      rejected: { class: "bg-red-100 text-red-800", text: "已驳回" }
    };

    // 检查URL参数并更新项目状态
    function checkUrlParamsAndUpdateStatus() {
      const urlParams = new URLSearchParams(window.location.search);
      const status = urlParams.get('status');
      const projectId = urlParams.get('projectId');
      
      if (status && projectId) {
        const projectIdNum = parseInt(projectId);
        const projectIndex = projectData.findIndex(p => p.id === projectIdNum);
        
        if (projectIndex !== -1) {
          if (status === 'approved') {
            projectData[projectIndex].status = 'approved';
            showToast('项目已审核通过', 'success');
          } else if (status === 'rejected') {
            projectData[projectIndex].status = 'rejected';
            showToast('项目已驳回', 'warning');
          }
          
          // 清除URL参数
          window.history.replaceState({}, document.title, window.location.pathname);
        }
      }
    }

    // 显示提示信息
    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      toast.className = `fixed top-4 right-4 px-4 py-2 rounded-md text-white z-50 ${
        type === 'success' ? 'bg-green-500' : 
        type === 'error' ? 'bg-red-500' : 
        type === 'warning' ? 'bg-yellow-500' : 
        'bg-blue-500'
      }`;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transition = 'opacity 0.5s ease';
        setTimeout(() => {
          document.body.removeChild(toast);
        }, 500);
      }, 3000);
    }

    // 渲染项目表格
    function renderProjectTable() {
      const tableBody = document.getElementById('projectTableBody');
      tableBody.innerHTML = '';

      projectData.forEach(project => {
        const row = document.createElement('tr');
        
        // 序号
        const idCell = document.createElement('td');
        idCell.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-500';
        idCell.textContent = project.id;
        row.appendChild(idCell);
        
        // 项目名称
        const nameCell = document.createElement('td');
        nameCell.className = 'px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900';
        nameCell.textContent = project.name;
        row.appendChild(nameCell);
        
        // 创建人
        const creatorCell = document.createElement('td');
        creatorCell.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-500';
        creatorCell.textContent = project.creator;
        row.appendChild(creatorCell);
        
        // 创建时间
        const timeCell = document.createElement('td');
        timeCell.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-500';
        timeCell.textContent = project.createTime;
        row.appendChild(timeCell);
        
        // 状态
        const statusCell = document.createElement('td');
        statusCell.className = 'px-6 py-4 whitespace-nowrap';
        const statusSpan = document.createElement('span');
        statusSpan.className = `px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusConfig[project.status].class}`;
        statusSpan.textContent = statusConfig[project.status].text;
        statusCell.appendChild(statusSpan);
        row.appendChild(statusCell);
        
        // 操作
        const actionCell = document.createElement('td');
        actionCell.className = 'py-3 px-4 text-left';
        const accountBtn = document.createElement('button');
        accountBtn.className = 'text-purple-600 hover:text-purple-900';
        accountBtn.innerHTML = '<i class="far fa-list-alt mr-1"></i>账目详情';
        accountBtn.onclick = () => window.location.href = 'account-details.html?projectId=' + project.id;
        actionCell.appendChild(accountBtn);
        row.appendChild(actionCell);
        tableBody.appendChild(row);
      });
    }

    // 显示模态窗口
    function showModal(modalId) {
      const modal = document.getElementById(modalId);
      modal.classList.remove('opacity-0', 'pointer-events-none', 'hidden');
      modal.classList.add('opacity-100');
      
      // 关闭模态窗口的事件
      const closeButtons = modal.querySelectorAll('.modal-close');
      const overlay = modal.querySelector('.modal-overlay');
      
      const closeModal = () => {
        modal.classList.add('opacity-0', 'pointer-events-none');
        setTimeout(() => {
          modal.classList.add('hidden');
        }, 300);
      };
      
      closeButtons.forEach(button => {
        button.addEventListener('click', closeModal);
      });
      
      overlay.addEventListener('click', closeModal);
    }
    
    // 显示右侧抽屉
    function showDrawer(drawerId) {
      const drawer = document.getElementById(drawerId);
      const overlay = document.getElementById('drawerOverlay');
      
      drawer.classList.add('open');
      overlay.classList.add('open');
      
      // 关闭抽屉的事件
      const closeButtons = drawer.querySelectorAll('.drawer-close');
      
      const closeDrawer = () => {
        drawer.classList.remove('open');
        overlay.classList.remove('open');
      };
      
      closeButtons.forEach(button => {
        button.addEventListener('click', closeDrawer);
      });
      
      overlay.addEventListener('click', closeDrawer);
    }

    // 关闭右侧抽屉（供按钮直接调用）
    function hideDrawer(drawerId) {
      const drawer = document.getElementById(drawerId);
      const overlay = document.getElementById('drawerOverlay');
      if (drawer) drawer.classList.remove('open');
      if (overlay) overlay.classList.remove('open');
    }

    // 打开保证金抽屉并填充数据
    function openDepositDrawer(project) {
      // 示例数据，可后续替换为后端返回
      const depositInfo = {
        total: 30000,
        paid: 22000,
        pending: 8000,
      };
      document.getElementById('depositTotal').textContent = '¥' + depositInfo.total.toLocaleString();
      document.getElementById('depositPaid').textContent = '¥' + depositInfo.paid.toLocaleString();
      document.getElementById('depositPending').textContent = '¥' + depositInfo.pending.toLocaleString();
      showDrawer('depositDrawer');
    }

    // 打开账号审核抽屉并填充数据
    function openAccountAuditDrawer(project) {
      const accounts = [
        { name: '渠道-抖音', required: 10000, paid: 9000 },
        { name: '门店-杭州西湖', required: 8000, paid: 8000 },
        { name: '平台-服务费', required: 5000, paid: 3000 },
      ];
      const tbody = document.getElementById('accountAuditTableBody');
      tbody.innerHTML = '';
      accounts.forEach((acc, idx) => {
        const pending = acc.required - acc.paid;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="py-2 px-4 border-b text-sm">${acc.name}</td>
          <td class="py-2 px-4 border-b text-right text-sm">¥${acc.required.toLocaleString()}</td>
          <td class="py-2 px-4 border-b text-right text-sm">¥${acc.paid.toLocaleString()}</td>
          <td class="py-2 px-4 border-b text-right text-sm ${pending>0?'text-red-600':'text-green-600'}">${pending>0?('¥'+pending.toLocaleString()):'—'}</td>
          <td class="py-2 px-4 border-b text-sm">${pending>0?'<span class="text-red-600">未交够</span>':'<span class="text-green-600">已交够</span>'}</td>
          <td class="py-2 px-4 border-b text-right text-sm">
            <button class="text-blue-600 hover:text-blue-800 mr-2" onclick="openEditDepositModal(${idx})"><i class="far fa-edit mr-1"></i>编辑</button>
            ${pending>0?
              '<button class="text-blue-600 hover:text-blue-800" onclick="submitDepositAudit()"><i class="far fa-paper-plane mr-1"></i>发起补缴审核</button>' :
              '<button class="text-green-600 hover:text-green-800" onclick="approveAccount()"><i class="fas fa-check mr-1"></i>审核通过</button>'
            }
          </td>
        `;
        tbody.appendChild(tr);
      });
      // 缓存数据以支持编辑弹窗
      window.accountAuditData = accounts;
      window.currentAuditProject = project;
      showDrawer('accountAuditDrawer');
    }

    function submitDepositAudit() {
      showToast('已提交补缴审核', 'success');
    }

    function approveAccount() {
      showToast('该账号保证金审核通过', 'success');
    }

    // 渲染账号审核表格（用于编辑后刷新）
    function renderAccountAuditTable() {
      const tbody = document.getElementById('accountAuditTableBody');
      if (!tbody || !Array.isArray(window.accountAuditData)) return;
      tbody.innerHTML = '';
      window.accountAuditData.forEach((acc, idx) => {
        const pending = acc.required - acc.paid;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="py-2 px-4 border-b text-sm">${acc.name}</td>
          <td class="py-2 px-4 border-b text-right text-sm">¥${acc.required.toLocaleString()}</td>
          <td class="py-2 px-4 border-b text-right text-sm">¥${acc.paid.toLocaleString()}</td>
          <td class="py-2 px-4 border-b text-right text-sm ${pending>0?'text-red-600':'text-green-600'}">${pending>0?('¥'+pending.toLocaleString()):'—'}</td>
          <td class="py-2 px-4 border-b text-sm">${pending>0?'<span class="text-red-600">未交够</span>':'<span class="text-green-600">已交够</span>'}</td>
          <td class="py-2 px-4 border-b text-right text-sm">
            <button class="text-blue-600 hover:text-blue-800 mr-2" onclick="openEditDepositModal(${idx})"><i class="far fa-edit mr-1"></i>编辑</button>
            ${pending>0?
              '<button class="text-blue-600 hover:text-blue-800" onclick="submitDepositAudit()"><i class="far fa-paper-plane mr-1"></i>发起补缴审核</button>' :
              '<button class="text-green-600 hover:text-green-800" onclick="approveAccount()"><i class="fas fa-check mr-1"></i>审核通过</button>'
            }
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // 打开编辑保证金额弹窗
    function openEditDepositModal(index) {
      if (!Array.isArray(window.accountAuditData)) return;
      window.selectedAccountIndex = index;
      const acc = window.accountAuditData[index];
      const nameEl = document.getElementById('editAccountName');
      const requiredEl = document.getElementById('editRequiredAmount');
      const inputEl = document.getElementById('editDepositAmount');
      if (nameEl) nameEl.textContent = acc.name;
      if (requiredEl) requiredEl.textContent = '¥' + acc.required.toLocaleString();
      if (inputEl) inputEl.value = acc.paid;
      showModal('editDepositModal');
    }

    // 保存编辑的保证金额
    function saveEditedDeposit() {
      const inputEl = document.getElementById('editDepositAmount');
      const value = parseFloat(inputEl && inputEl.value ? inputEl.value : '0');
      const idx = window.selectedAccountIndex;
      if (isNaN(value) || idx == null || !Array.isArray(window.accountAuditData)) {
        showToast('填写的保证金额不合法', 'error');
        return;
      }
      window.accountAuditData[idx].paid = Math.max(value, 0);
      renderAccountAuditTable();
      const closeBtn = document.querySelector('#editDepositModal .modal-close');
      if (closeBtn) closeBtn.click();
      showToast('保证金额已更新', 'success');
    }

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', function() {
      // 检查URL参数并更新项目状态
      checkUrlParamsAndUpdateStatus();
      // 渲染项目表格
      renderProjectTable();
    });
  </script>
</body>
</html>