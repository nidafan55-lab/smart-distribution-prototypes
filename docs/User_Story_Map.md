# 分账系统用户故事地图 (User Story Map)

## 1. 用户故事地图概述

用户故事地图是一种可视化工具，用于组织和规划用户与产品的交互流程。本文档将分账系统的用户活动、任务和故事按照用户体验的时间顺序和优先级进行排列，帮助团队理解用户需求和产品功能的关系。

### 1.1 用户故事地图的目的

- 提供产品功能的全景视图，展示用户如何使用产品
- 识别用户旅程中的关键步骤和潜在问题
- 帮助团队理解功能之间的关系和依赖
- 指导产品开发的优先级和迭代规划
- 为UI/UX设计师提供用户流程和交互需求的清晰指导

### 1.2 主要用户角色

1. **系统管理员**：负责系统配置、用户权限管理和全局设置
2. **财务管理员**：负责设置分账规则、审批分账方案和监控资金流向
3. **账户管理员**：负责管理特定账户的日常操作和分账执行
4. **普通用户**：查看自己账户的分账记录和资金状况
5. **审计人员**：审查分账记录和操作日志，确保合规性

## 2. 用户活动流 (横向)

用户活动流代表了用户使用产品的主要阶段，按照时间顺序从左到右排列。

```mermaid
graph LR
    A[账户管理] --> B[分账规则设置]
    B --> C[交易记录]
    C --> D[分账执行]
    D --> E[报表分析]
```

### 2.1 账户管理

用户在系统中创建和管理账户，建立账户之间的层级关系。

### 2.2 分账规则设置

用户定义如何在不同账户之间分配资金的规则和条件。

### 2.3 交易记录

用户记录和管理系统中的资金交易。

### 2.4 分账执行

系统根据设定的规则执行分账操作，将资金分配到相应账户。

### 2.5 报表分析

用户查看和分析分账结果，生成报表和可视化数据。

## 3. 用户任务分解 (纵向)

每个用户活动下，按照优先级从上到下分解为具体的用户任务。

### 3.1 账户管理

#### 核心任务
1. **创建账户**
   - 作为系统管理员，我想要创建新账户，以便将其纳入分账系统
   - 作为账户管理员，我想要为我管理的部门创建子账户，以便进行更细粒度的资金管理

2. **设置账户层级关系**
   - 作为系统管理员，我想要定义账户之间的层级关系，以便建立清晰的组织结构
   - 作为财务管理员，我想要调整账户层级，以适应组织结构变化

3. **管理账户信息**
   - 作为账户管理员，我想要更新账户基本信息，以保持数据准确性
   - 作为系统管理员，我想要设置账户状态（活跃/冻结/关闭），以控制账户使用权限

#### 次要任务
4. **账户标签和分类**
   - 作为财务管理员，我想要给账户添加标签，以便更好地组织和筛选账户

5. **账户权限管理**
   - 作为系统管理员，我想要为不同用户分配账户访问权限，以确保数据安全

6. **账户余额查询**
   - 作为普通用户，我想要查看我的账户余额，以了解我的资金状况

### 3.2 分账规则设置

#### 核心任务
1. **创建基础分账规则**
   - 作为财务管理员，我想要创建按比例分账的规则，以便自动分配资金
   - 作为财务管理员，我想要创建按固定金额分账的规则，以满足特定的分账需求

2. **设置规则触发条件**
   - 作为财务管理员，我想要设置规则触发条件（如定时、余额阈值），以便自动执行分账

3. **规则优先级管理**
   - 作为财务管理员，我想要设置规则执行的优先级，以处理多规则冲突情况

#### 次要任务
4. **创建规则模板**
   - 作为财务管理员，我想要保存常用的分账规则为模板，以便快速应用

5. **规则有效期设置**
   - 作为财务管理员，我想要为规则设置有效期，以便自动失效过期规则

6. **规则审批流程**
   - 作为系统管理员，我想要审批重要的分账规则变更，以确保合规性

### 3.3 交易记录

#### 核心任务
1. **记录交易**
   - 作为账户管理员，我想要记录账户的收入和支出，以便追踪资金流向
   - 作为财务管理员，我想要批量导入交易记录，以提高工作效率

2. **交易分类**
   - 作为账户管理员，我想要对交易进行分类，以便更好地组织财务数据

3. **交易查询**
   - 作为普通用户，我想要查询我的交易历史，以了解资金使用情况
   - 作为审计人员，我想要按条件筛选交易记录，以进行审计工作

#### 次要任务
4. **交易附件管理**
   - 作为账户管理员，我想要上传交易相关的附件（如发票、合同），以便完整记录交易信息

5. **交易备注**
   - 作为账户管理员，我想要为交易添加备注，以记录额外信息

6. **交易状态管理**
   - 作为财务管理员，我想要更新交易状态（如待处理、已完成、已取消），以跟踪交易进度

### 3.4 分账执行

#### 核心任务
1. **手动触发分账**
   - 作为财务管理员，我想要手动触发分账操作，以便在需要时立即执行分账

2. **自动分账执行**
   - 作为系统用户，我希望系统能根据预设条件自动执行分账，以减少手动操作

3. **分账结果确认**
   - 作为财务管理员，我想要确认分账结果，以确保分账准确无误

#### 次要任务
4. **分账执行日志**
   - 作为审计人员，我想要查看分账执行的详细日志，以便进行审计

5. **分账异常处理**
   - 作为财务管理员，我想要处理分账过程中的异常情况，以确保系统正常运行

6. **分账撤销**
   - 作为财务管理员，我想要在必要时撤销错误的分账操作，以纠正错误

### 3.5 报表分析

#### 核心任务
1. **查看基础报表**
   - 作为财务管理员，我想要查看账户余额报表，以了解资金分布情况
   - 作为账户管理员，我想要查看交易流水报表，以分析资金流向

2. **数据导出**
   - 作为财务管理员，我想要导出报表数据，以便进行离线分析或提交给其他部门

3. **分账统计**
   - 作为系统管理员，我想要查看分账规则执行统计，以评估系统运行情况

#### 次要任务
4. **自定义报表**
   - 作为财务管理员，我想要创建自定义报表，以满足特定的分析需求

5. **数据可视化**
   - 作为系统用户，我想要通过图表直观地查看数据，以便更好地理解数据含义

6. **预测分析**
   - 作为财务管理员，我想要基于历史数据进行预测分析，以辅助决策

## 4. 故事优先级与版本映射

将用户故事按照优先级映射到产品路线图中的不同版本。

### 4.1 MVP (v1.0) - 基础分账系统

**账户管理**:
- 创建账户
- 设置两级账户层级关系
- 管理账户基本信息

**分账规则设置**:
- 创建基础分账规则（按比例、按固定金额）
- 设置简单的规则触发条件

**交易记录**:
- 记录基本交易
- 简单交易查询

**分账执行**:
- 手动触发分账
- 分账结果确认

**报表分析**:
- 查看基础账户余额报表
- 简单数据导出功能

### 4.2 增强版 (v2.0) - 多层级分账

**账户管理**:
- 支持多层级账户结构（5层以上）
- 账户标签和分类
- 完善的账户权限管理

**分账规则设置**:
- 高级分账规则（条件组合、多级联动）
- 规则优先级管理
- 规则模板功能

**交易记录**:
- 交易分类和标签
- 高级交易查询和筛选
- 交易附件管理

**分账执行**:
- 自动分账执行
- 分账执行日志
- 基础异常处理

**报表分析**:
- 高级报表功能
- 增强的数据导出选项
- 基础数据可视化

### 4.3 专业版 (v3.0) - 智能分析与集成

**账户管理**:
- 动态账户结构调整
- 高级账户分析

**分账规则设置**:
- 智能规则推荐
- 规则有效期和审批流程
- 规则冲突检测

**交易记录**:
- 智能交易分类
- 交易模式识别
- 交易关联分析

**分账执行**:
- 智能分账优化
- 分账撤销和回滚
- 高级异常处理

**报表分析**:
- 自定义报表
- 高级数据可视化
- 预测分析功能

### 4.4 企业版 (v4.0) - 全面解决方案

**账户管理**:
- 多币种支持
- 跨组织账户管理
- 账户合并与拆分

**分账规则设置**:
- 跨国分账合规管理
- 企业级审批流程
- 规则版本控制

**交易记录**:
- 大规模交易处理优化
- 交易合规检查
- 高级审计功能

**分账执行**:
- 复杂场景分账处理
- 分账性能优化
- 完整的异常处理机制

**报表分析**:
- 企业级报表引擎
- 高级商业智能集成
- 多维度分析

## 5. UI/UX设计指导

为UI设计师提供的关键界面和交互设计指导。

### 5.1 关键界面设计要点

#### 账户管理界面
- 提供树状结构展示账户层级关系
- 支持拖拽调整账户层级
- 使用卡片式设计展示账户基本信息
- 账户状态使用醒目的颜色标识（绿色-活跃，黄色-待激活，红色-冻结）

#### 分账规则配置界面
- 提供直观的规则构建器，支持拖拽操作
- 使用流程图形式展示复杂规则的执行逻辑
- 规则模拟测试功能需要清晰展示测试结果
- 规则冲突检测需要醒目提示

#### 交易管理界面
- 提供时间轴视图展示交易历史
- 支持多维度筛选和搜索
- 交易详情页面需包含完整信息和相关操作

#### 分账执行界面
- 提供分账执行前的预览功能
- 分账结果需要清晰展示每个账户的分账金额和比例
- 异常情况需要醒目提示并提供处理建议

#### 报表分析界面
- 提供多种图表类型（柱状图、饼图、折线图等）
- 支持图表交互（钻取、筛选、缩放等）
- 报表导出选项需要清晰易用

### 5.2 交互设计原则

1. **一致性**：保持界面元素、交互方式和术语的一致性
2. **反馈性**：所有操作都应提供明确的反馈
3. **效率**：减少操作步骤，提供快捷方式
4. **容错性**：防止用户错误，提供撤销和恢复机制
5. **可学习性**：界面应直观易懂，减少学习成本

### 5.3 移动端适配要点

1. **响应式设计**：确保界面在不同屏幕尺寸下正常显示
2. **触控优化**：按钮和交互元素大小适合手指操作
3. **简化视图**：移动端优先展示核心功能和数据
4. **手势支持**：利用滑动、捏合等手势提升用户体验

### 5.4 无障碍设计要求

1. **键盘导航**：所有功能可通过键盘操作
2. **屏幕阅读器支持**：提供适当的ARIA标签
3. **颜色对比度**：确保文本和背景的对比度符合WCAG标准
4. **可调整文本大小**：支持文本缩放而不破坏布局

## 6. 原型设计参考

为UI设计师提供的关键界面原型参考描述。

### 6.1 账户管理界面原型

**主要组件**:
- 左侧导航栏：包含系统主要功能模块
- 账户树状结构：可展开/折叠的树状视图
- 账户信息卡片：展示账户基本信息、余额和状态
- 操作按钮：创建、编辑、冻结等常用操作
- 搜索和筛选工具：快速定位特定账户

**交互流程**:
1. 用户可通过树状结构浏览账户层级
2. 点击账户显示详细信息卡片
3. 右键账户或使用操作按钮执行相关操作
4. 拖拽调整账户层级关系

### 6.2 分账规则配置界面原型

**主要组件**:
- 规则列表：展示已创建的规则
- 规则构建器：可视化规则编辑区域
- 条件设置面板：配置触发条件和参数
- 账户选择器：选择参与分账的账户
- 分账比例/金额设置：配置分账参数
- 规则模拟测试区：验证规则效果

**交互流程**:
1. 用户创建新规则或选择已有规则编辑
2. 在规则构建器中设置分账逻辑
3. 配置规则触发条件和执行参数
4. 使用模拟测试功能验证规则效果
5. 保存规则并设置状态（启用/禁用）

### 6.3 分账执行界面原型

**主要组件**:
- 可分配资金显示：当前可分配总额
- 规则选择器：选择要执行的规则
- 分账预览表格：展示预计分账结果
- 校验结果区域：显示规则校验信息
- 执行按钮：触发分账操作
- 结果确认对话框：确认分账结果

**交互流程**:
1. 用户选择要执行的分账规则
2. 系统显示分账预览结果
3. 用户检查校验信息，确保无误
4. 用户点击执行按钮，触发分账
5. 系统执行分账并显示结果
6. 用户确认结果完成操作

### 6.4 报表分析界面原型

**主要组件**:
- 报表类型选择器：选择不同类型的报表
- 时间范围选择器：设置数据时间范围
- 筛选条件面板：设置数据筛选条件
- 图表展示区：可视化展示数据
- 数据表格：详细数据列表
- 导出工具栏：导出报表和数据

**交互流程**:
1. 用户选择报表类型和时间范围
2. 设置筛选条件细化数据
3. 系统生成图表和数据表格
4. 用户可与图表交互（如钻取、缩放）
5. 用户可导出报表或原始数据